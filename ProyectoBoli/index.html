<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Formulario</title>
    <!-- Se incluye el framework Bootstrap para darle estilo al formulario -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <!-- Se incluye la librería jsPDF para generar el PDF -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.3.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.20/jspdf.plugin.autotable.min.js"></script>
    <script type="text/javascript" src="jspdf.min.js"></script>
    <script type="text/javascript" src="./jsPDF-AutoTable-master/dist/jspdf.plugin.autotable.js"></script>
    <script type="text/javascript" src="jspdf.plugin.autotable.js"></script>
    <!-- Se incluye la librería SheetJS para trabajar con la hoja de Excel -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.16.9/xlsx.full.min.js"></script>
</head>
<body>
    <div class="container">
        <h1>Formulario</h1>
        <!-- Se crea el formulario con los campos solicitados -->
        <form id="formulario">
            <div class="form-group">
                <label for="nombre">Nombre</label>
                <input type="text" class="form-control" id="nombre" name="nombre" required>
            </div>
            <div class="form-group">
                <label for="cedula">Cédula</label>
                <input type="number" class="form-control" id="cedula" name="cedula" required>
            </div>
            <div class="form-group">
                <label for="marca">Marca</label>
                <input type="text" class="form-control" id="marca" name="marca" required>
            </div>
            <div class="form-group">
                <label for="referencia">Referencia</label>
                <input type="text" class="form-control" id="referencia" name="referencia" required>
            </div>
            <div class="form-group">
                <label for="modelo">Modelo</label>
                <input type="text" class="form-control" id="modelo" name="modelo" required>
            </div>
            <div class="form-group">
                <label for="serial">Serial</label>
                <input type="text" class="form-control" id="serial" name="serial" required>
            </div>
            <div class="form-group">
                <label for="tipo">Tipo</label>
                <input type="text" class="form-control" id="tipo" name="tipo" required>
            </div>
            <div class="form-group">
                <label for="factura">Factura</label>
                <input type="text" class="form-control" id="factura" name="factura" required>
            </div>
            <button type="submit" class="btn btn-primary">Enviar</button>
        </form>
    </div>
    <!-- Se crea un script para manejar la lógica del formulario -->
    <script>
        // Se obtiene el elemento del formulario
        var formulario = document.getElementById("formulario");
        // Se agrega un evento al enviar el formulario
        formulario.addEventListener("submit", function(event) {
            // Se evita el comportamiento por defecto del formulario
            event.preventDefault();
            // Se obtiene la información del formulario
            var data = new FormData(formulario);
            // Se crea un objeto para almacenar la información
            var info = {};
            // Se recorre la información y se asigna al objeto
            for (var pair of data.entries()) {
                info[pair[0]] = pair[1];
            }
            // Se llama a la función para guardar la información en la hoja de Excel
            guardarExcel(info);
            // Se llama a la función para generar el PDF de la hoja de Excel
            generarPDF();
            // Se limpia el formulario
            formulario.reset();
        });
        // Se crea una función para guardar la información en la hoja de Excel
        function guardarExcel(info) {
            // Se obtiene el archivo e.xlsx como un objeto Blob
            fetch("e.xlsx").then(function(response) {
                return response.blob();
            }).then(function(blob) {
                // Se lee el archivo e.xlsx
                var reader = new FileReader();
                reader.readAsBinaryString(blob); // Se pasa el objeto Blob al método readAsBinaryString
                // Se espera a que se cargue el archivo
                reader.onload = function(e) {
                    // Se obtiene el contenido del archivo
                    var data = e.target.result;
                    // Se lee el libro de trabajo
                    var workbook = XLSX.read(data, {type: "binary"});
                    // Se obtiene la hoja de trabajo con el nombre e
                    var worksheet = workbook.Sheets["e"];
                    // Se obtiene el rango de celdas de la hoja de trabajo
                    var range = XLSX.utils.decode_range(worksheet["!ref"]);
                    // Se incrementa el número de filas del rango
                    range.e.r++;
                    // Se actualiza el rango de celdas de la hoja de trabajo
                    worksheet["!ref"] = XLSX.utils.encode_range(range);
                    // Se agrega la información a la hoja de trabajo
                    XLSX.utils.sheet_add_json(worksheet, [info], {origin: -1});
                    // Se guarda el libro de trabajo en un archivo llamado e.xlsx
                    XLSX.writeFile(workbook, "e.xlsx");
                };
            });
        }
        // Se crea una función para generar el PDF de la hoja de Excel
        function generarPDF() {
            // Se crea un objeto de jsPDF con la orientación horizontal
            var pdf = new jsPDF({orientation: "landscape"}); // Se cambia la orientación a landscape
            // Se obtiene el archivo e.xlsx como un objeto Blob
            fetch("e.xlsx").then(function(response) {
                return response.blob();
            }).then(function(blob) {
                // Se lee el archivo e.xlsx
                var reader = new FileReader();
                reader.readAsBinaryString(blob); // Se pasa el objeto Blob al método readAsBinaryString
                // Se espera a que se cargue el archivo
                reader.onload = function(e) {
                    // Se obtiene el contenido del archivo
                    var data = e.target.result;
                    // Se lee el libro de trabajo
                    var workbook = XLSX.read(data, {type: "binary"});
                    // Se obtiene la hoja de trabajo con el nombre e
                    var worksheet = workbook.Sheets["e"];
                    // Se convierte la hoja de trabajo a un arreglo de arreglos
                    var array = XLSX.utils.sheet_to_json(worksheet, {header: 1});
                    // Se agrega el arreglo al PDF con un tamaño de fuente menor y un ancho de columna ajustado
                    pdf.autoTable({
                        head: [array[0]],
                        body: array.slice(1),
                        
                        columnStyles: {0: {cellWidth: 50}} // Se ajusta el ancho de la primera columna a 50
                    });
                    // Se guarda el PDF con el nombre e.pdf
                    pdf.save("e.pdf");
                };
            });
        }
    </script>
</html>